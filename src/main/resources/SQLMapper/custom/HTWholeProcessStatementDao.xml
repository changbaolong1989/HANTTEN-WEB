<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hd.manager.dao.HTWholeProcessStatementDao">

    <resultMap id="BaseResultMap" type="com.hd.manager.dao.bean.HTProStatementBean">
        <id column="statement_id" jdbcType="VARCHAR" property="statementId"/>
        <result column="contract_id" jdbcType="VARCHAR" property="contractId"/>
        <result column="contract_num" jdbcType="VARCHAR" property="contractNum" />
        <result column="treaty_type" jdbcType="VARCHAR" property="treatyType" />
        <result column="undertake_type" jdbcType="VARCHAR" property="undertakeType" />
        <result column="contract_name" jdbcType="VARCHAR" property="contractName" />
        <result column="contract_unit" jdbcType="VARCHAR" property="contractUnit" />
        <result column="plan_date" jdbcType="TIMESTAMP" property="planDate" />
        <result column="contract_class" jdbcType="VARCHAR" property="contractClass" />
        <result column="target_cost" jdbcType="DOUBLE" property="targetCost" />
        <result column="excise_money" jdbcType="DOUBLE" property="exciseMoney" />
        <result column="tax_ratio" jdbcType="DOUBLE" property="taxRatio" />
        <result column="tax_money" jdbcType="DOUBLE" property="taxMoney" />
        <result column="with_tax_money" jdbcType="DOUBLE" property="withTaxMoney" />
        <result column="statement_amount" jdbcType="DOUBLE" property="statementAmount" />
        <result column="drawing_scheme" jdbcType="DOUBLE" property="drawingScheme" />
        <result column="alter_discuss" jdbcType="DOUBLE" property="alterDiscuss" />
        <result column="visa" jdbcType="DOUBLE" property="visa" />
        <result column="adjust_price" jdbcType="DOUBLE" property="adjustPrice" />
        <result column="surge_price" jdbcType="DOUBLE" property="surgePrice" />
        <result column="service_fee" jdbcType="DOUBLE" property="serviceFee" />
        <result column="tax_price" jdbcType="DOUBLE" property="taxPrice" />
        <result column="other_thing" jdbcType="DOUBLE" property="otherThing" />
        <result column="remark" jdbcType="VARCHAR" property="remark" />
    </resultMap>


    <select id="searchWholeProcessStatement" resultMap="BaseResultMap">
        SELECT
        T.statement_id,
        T.contract_id,
        T1.contract_num,
        T1.treaty_type,
        T1.undertake_type,
        T1.contract_name,
        T1.contract_unit,
        T1.plan_date,
        T1.contract_class,
        T1.target_cost,
        T1.excise_money,
        T1.tax_ratio,
        T1.tax_money,
        T1.with_tax_money,
        T.statement_amount,
        T.drawing_scheme,
        T.alter_discuss,
        T.visa,
        T.adjust_price,
        T.surge_price,
        T.service_fee,
        T.tax_price,
        T.other_thing,
        T.remark
        FROM
        tb_pro_statement T
        LEFT JOIN tb_pro_contract T1 ON T.contract_id = T1.contract_id
        WHERE 1=1
        AND T.project_id = #{projectId}
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
        <if test="pageNumber != null and pageNumber>=0 and pageSize != null and pageSize >0 ">
            limit #{pageNumber} , #{pageSize}
        </if>
    </select>


    <select id="searchExportData" parameterType="java.lang.String" resultType="java.util.Map">
        SELECT
            T1.contract_num,
        CASE
                WHEN T1.treaty_type = 1 THEN
                '工程类合同'
                WHEN T1.treaty_type = 2 THEN
                '采购类合同'
                WHEN T1.treaty_type = 3 THEN
                '服务类合同'
                WHEN T1.treaty_type = 4 THEN
                '土地类合同'
                WHEN T1.treaty_type = 5 THEN
                '其他类合同' ELSE '-'
            END AS treaty_type,
        CASE
                WHEN T1.undertake_type = 1 THEN
                '施工总承包'
                WHEN T1.undertake_type = 2 THEN
                '发包人发包专业合同'
                WHEN T1.undertake_type = 3 THEN
                '发包人自行发包专业' ELSE ''
            END AS undertake_type,
            T1.contract_name,
            T1.contract_unit,
            T1.plan_date,
            CASE
                WHEN T1.contract_class = 1 THEN
                '单价合同'
                WHEN T1.contract_class = 2 THEN
                '总价合同'
                WHEN T1.contract_class = 3 THEN
                '其他' ELSE ''
            END AS contract_class,
            T1.target_cost,
            T1.excise_money,
            T1.tax_ratio,
            T1.tax_money,
            T1.with_tax_money,
            T.statement_amount,
            T.drawing_scheme,
            T.alter_discuss,
            T.visa,
            T.adjust_price,
            T.surge_price,
            T.service_fee,
            T.tax_price,
            T.other_thing,
            T.remark
        FROM
            tb_pro_statement T
            LEFT JOIN tb_pro_contract T1 ON T.contract_id = T1.contract_id
        WHERE
            1 = 1
            AND T.project_id = #{projectId}
        ORDER BY
            T1.treaty_type,
            T1.undertake_type
    </select>


</mapper>
